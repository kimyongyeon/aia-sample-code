<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>DataShare ìœ í‹¸ë¦¬í‹° í…ŒìŠ¤íŠ¸ (ì¸ë¼ì¸ ë²„ì „)</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        background: white;
        border-radius: 15px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        overflow: hidden;
      }

      .header {
        background: linear-gradient(45deg, #2196f3, #21cbf3);
        color: white;
        padding: 30px;
        text-align: center;
      }

      .header h1 {
        font-size: 2.5rem;
        margin-bottom: 10px;
      }

      .header p {
        font-size: 1.1rem;
        opacity: 0.9;
      }

      .content {
        padding: 30px;
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 30px;
      }

      .section {
        background: #f8f9fa;
        border-radius: 10px;
        padding: 25px;
        border: 1px solid #e9ecef;
      }

      .section h2 {
        color: #495057;
        margin-bottom: 20px;
        font-size: 1.4rem;
        border-bottom: 2px solid #dee2e6;
        padding-bottom: 10px;
      }

      .form-group {
        margin-bottom: 20px;
      }

      .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: #495057;
      }

      .form-group input,
      .form-group textarea,
      .form-group select {
        width: 100%;
        padding: 12px;
        border: 2px solid #dee2e6;
        border-radius: 8px;
        font-size: 14px;
        transition: border-color 0.3s ease;
      }

      .form-group input:focus,
      .form-group textarea:focus,
      .form-group select:focus {
        outline: none;
        border-color: #2196f3;
        box-shadow: 0 0 0 3px rgba(33, 150, 243, 0.1);
      }

      .btn {
        background: linear-gradient(45deg, #2196f3, #21cbf3);
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 600;
        transition: transform 0.2s ease, box-shadow 0.2s ease;
        margin-right: 10px;
        margin-bottom: 10px;
      }

      .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(33, 150, 243, 0.4);
      }

      .btn-danger {
        background: linear-gradient(45deg, #f44336, #e91e63);
      }

      .btn-danger:hover {
        box-shadow: 0 5px 15px rgba(244, 67, 54, 0.4);
      }

      .btn-success {
        background: linear-gradient(45deg, #4caf50, #8bc34a);
      }

      .btn-success:hover {
        box-shadow: 0 5px 15px rgba(76, 175, 80, 0.4);
      }

      .output {
        background: #1a1a1a;
        color: #00ff00;
        padding: 20px;
        border-radius: 8px;
        font-family: "Courier New", monospace;
        font-size: 13px;
        line-height: 1.6;
        max-height: 300px;
        overflow-y: auto;
        margin-top: 15px;
        border: 2px solid #333;
      }

      .output .log-entry {
        margin-bottom: 8px;
        padding: 5px 0;
        border-bottom: 1px solid #333;
      }

      .output .log-time {
        color: #888;
        font-size: 11px;
      }

      .output .log-action {
        color: #00bfff;
        font-weight: bold;
      }

      .output .log-key {
        color: #ffff00;
      }

      .output .log-value {
        color: #00ff00;
      }

      .current-data {
        background: #e3f2fd;
        border: 2px solid #2196f3;
        border-radius: 8px;
        padding: 15px;
        margin-top: 15px;
      }

      .current-data h3 {
        color: #1976d2;
        margin-bottom: 10px;
      }

      .data-item {
        background: white;
        padding: 10px;
        margin: 5px 0;
        border-radius: 5px;
        border-left: 4px solid #2196f3;
        font-family: "Courier New", monospace;
        font-size: 12px;
      }

      .data-key {
        font-weight: bold;
        color: #1976d2;
      }

      .data-value {
        color: #424242;
        margin-left: 10px;
      }

      .status {
        position: fixed;
        top: 20px;
        right: 20px;
        background: #4caf50;
        color: white;
        padding: 10px 20px;
        border-radius: 20px;
        font-weight: bold;
        box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);
        z-index: 1000;
      }

      @media (max-width: 768px) {
        .content {
          grid-template-columns: 1fr;
          gap: 20px;
        }

        .header h1 {
          font-size: 2rem;
        }
      }
    </style>
  </head>
  <body>
    <div class="status" id="status">DataShare ì¤€ë¹„ë¨</div>

    <div class="container">
      <div class="header">
        <h1>ğŸš€ DataShare ìœ í‹¸ë¦¬í‹° í…ŒìŠ¤íŠ¸ (ì¸ë¼ì¸ ë²„ì „)</h1>
        <p>SPA í™˜ê²½ì„ ìœ„í•œ ë©”ëª¨ë¦¬ ê¸°ë°˜ ë°˜ì‘í˜• ë°ì´í„° ê³µìœ  ì‹œìŠ¤í…œ</p>
      </div>

      <div class="content">
        <!-- ë°ì´í„° ì¡°ì‘ ì„¹ì…˜ -->
        <div class="section">
          <h2>ğŸ“ ë°ì´í„° ì¡°ì‘</h2>

          <div class="form-group">
            <label for="setKey">í‚¤ (Key)</label>
            <input
              type="text"
              id="setKey"
              placeholder="ì˜ˆ: user.name, app.theme"
              value="user.name"
            />
          </div>

          <div class="form-group">
            <label for="setValue">ê°’ (Value)</label>
            <textarea
              id="setValue"
              rows="3"
              placeholder='ì˜ˆ: "í™ê¸¸ë™", {"age": 25}, [1,2,3]'
            >
í™ê¸¸ë™</textarea
            >
          </div>

          <button class="btn" onclick="testSet()">ğŸ“¥ SET (ì €ì¥)</button>
          <button class="btn" onclick="testGet()">ğŸ“¤ GET (ì¡°íšŒ)</button>
          <button class="btn btn-danger" onclick="testClear()">
            ğŸ—‘ï¸ CLEAR (ì‚­ì œ)
          </button>

          <div class="form-group" style="margin-top: 20px">
            <label for="tempTtl">ì„ì‹œ ë°ì´í„° TTL (ë°€ë¦¬ì´ˆ)</label>
            <input
              type="number"
              id="tempTtl"
              value="5000"
              min="1000"
              max="300000"
            />
          </div>

          <button class="btn btn-success" onclick="testTemp()">
            â° TEMP (ì„ì‹œ ì €ì¥)
          </button>
          <button class="btn btn-danger" onclick="testClearAll()">
            ğŸ’¥ CLEAR ALL (ì „ì²´ ì‚­ì œ)
          </button>

          <div class="current-data">
            <h3>ğŸ“Š í˜„ì¬ ì €ì¥ëœ ë°ì´í„°</h3>
            <div id="currentData">ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</div>
          </div>
        </div>

        <!-- ê°ì‹œ ë° ë¡œê·¸ ì„¹ì…˜ -->
        <div class="section">
          <h2>ğŸ‘€ ê°ì‹œ (Watch) ë° ë¡œê·¸</h2>

          <div class="form-group">
            <label for="watchKey">ê°ì‹œí•  í‚¤</label>
            <input
              type="text"
              id="watchKey"
              placeholder="ì˜ˆ: user.*, app.theme"
              value="user.*"
            />
          </div>

          <button class="btn" onclick="testWatch()">ğŸ‘ï¸ WATCH ì‹œì‘</button>
          <button class="btn btn-danger" onclick="testUnwatch()">
            âŒ WATCH ì¤‘ì§€
          </button>
          <button class="btn" onclick="clearLogs()">ğŸ§¹ ë¡œê·¸ ì§€ìš°ê¸°</button>

          <div class="output" id="output">
            <div class="log-entry">
              <span class="log-time">[ì‹œì‘]</span>
              <span class="log-action"
                >DataShare ìœ í‹¸ë¦¬í‹°ê°€ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤.</span
              >
            </div>
          </div>

          <div style="margin-top: 20px">
            <h3>ğŸ”§ ê°œë°œì ì˜µì…˜</h3>
            <label>
              <input type="checkbox" id="devMode" onchange="toggleDevMode()" />
              ê°œë°œ ëª¨ë“œ (ì½˜ì†” ë¡œê¹…)
            </label>
          </div>
        </div>
      </div>
    </div>

    <script>
      "use strict";

      console.log("ğŸš€ [HTML] DataShare ì¸ë¼ì¸ ë²„ì „ ì‹œì‘");

      // DataShare í´ë˜ìŠ¤ ì •ì˜ (ì¸ë¼ì¸)
      class DataShare {
        constructor() {
          this._data = {};
          this._watchers = {};
          this._tempData = {};
          this._isDevMode = false;
        }

        setDevMode(enabled) {
          this._isDevMode = enabled;
          if (enabled) {
            console.log("[DataShare] ê°œë°œ ëª¨ë“œê°€ í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤.");
          }
        }

        set(key, value) {
          if (!key || typeof key !== "string") {
            throw new Error("í‚¤ëŠ” ë¬¸ìì—´ì´ì–´ì•¼ í•©ë‹ˆë‹¤.");
          }

          const oldValue = this._data[key];
          this._data[key] = value;

          if (this._isDevMode) {
            console.log(`[DataShare] SET: ${key}`, {
              oldValue,
              newValue: value,
            });
          }

          this._notify(key, value, oldValue);
        }

        get(key) {
          if (!key || typeof key !== "string") {
            throw new Error("í‚¤ëŠ” ë¬¸ìì—´ì´ì–´ì•¼ í•©ë‹ˆë‹¤.");
          }

          const value = this._data[key];

          if (this._isDevMode) {
            console.log(`[DataShare] GET: ${key}`, value);
          }

          return value;
        }

        watch(keys, callback) {
          if (!callback || typeof callback !== "function") {
            throw new Error("ì½œë°±ì€ í•¨ìˆ˜ì—¬ì•¼ í•©ë‹ˆë‹¤.");
          }

          const keyArray = Array.isArray(keys) ? keys : [keys];
          const unsubscribeFunctions = [];

          keyArray.forEach((key) => {
            if (!this._watchers[key]) {
              this._watchers[key] = [];
            }

            const watcherInfo = {
              callback,
              id: Date.now() + Math.random(),
            };

            this._watchers[key].push(watcherInfo);

            if (this._isDevMode) {
              console.log(`[DataShare] WATCH ë“±ë¡: ${key}`);
            }

            unsubscribeFunctions.push(() => {
              const index = this._watchers[key].findIndex(
                (w) => w.id === watcherInfo.id
              );
              if (index !== -1) {
                this._watchers[key].splice(index, 1);
                if (this._isDevMode) {
                  console.log(`[DataShare] WATCH í•´ì œ: ${key}`);
                }
              }
            });
          });

          return () => {
            unsubscribeFunctions.forEach((unsubscribe) => unsubscribe());
          };
        }

        clear(key) {
          if (key) {
            if (this._data.hasOwnProperty(key)) {
              const oldValue = this._data[key];
              delete this._data[key];

              if (this._isDevMode) {
                console.log(`[DataShare] CLEAR: ${key}`, oldValue);
              }

              this._notify(key, undefined, oldValue);
            }
          } else {
            const keys = Object.keys(this._data);
            this._data = {};

            if (this._isDevMode) {
              console.log("[DataShare] CLEAR ALL:", keys);
            }

            keys.forEach((k) => this._notify(k, undefined, this._data[k]));
          }
        }

        temp(key, value, ttl = 300000) {
          this.set(key, value);

          if (this._tempData[key]) {
            clearTimeout(this._tempData[key]);
          }

          this._tempData[key] = setTimeout(() => {
            this.clear(key);
            delete this._tempData[key];

            if (this._isDevMode) {
              console.log(`[DataShare] TEMP ìë™ ì‚­ì œ: ${key}`);
            }
          }, ttl);

          if (this._isDevMode) {
            console.log(`[DataShare] TEMP ì„¤ì •: ${key}, TTL: ${ttl}ms`);
          }
        }

        getAll() {
          return { ...this._data };
        }

        getKeys() {
          return Object.keys(this._data);
        }

        getKeysByPattern(pattern) {
          const regex = new RegExp(pattern.replace("*", ".*"));
          return Object.keys(this._data).filter((key) => regex.test(key));
        }

        _notify(key, newValue, oldValue) {
          if (this._watchers[key]) {
            this._watchers[key].forEach((watcher) => {
              try {
                watcher.callback(newValue, oldValue, key);
              } catch (error) {
                console.error(`[DataShare] ì½œë°± ì‹¤í–‰ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:`, error);
              }
            });
          }

          Object.keys(this._watchers).forEach((watchKey) => {
            if (watchKey.includes("*")) {
              const regex = new RegExp(watchKey.replace("*", ".*"));
              if (regex.test(key)) {
                this._watchers[watchKey].forEach((watcher) => {
                  try {
                    watcher.callback(newValue, oldValue, key);
                  } catch (error) {
                    console.error(
                      `[DataShare] íŒ¨í„´ ì½œë°± ì‹¤í–‰ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:`,
                      error
                    );
                  }
                });
              }
            }
          });
        }
      }

      // DataShare ì¸ìŠ¤í„´ìŠ¤ ìƒì„± ë° ì „ì—­ ë…¸ì¶œ
      console.log("âœ… [HTML] DataShare í´ë˜ìŠ¤ ì •ì˜ ì™„ë£Œ");

      try {
        const dataShareInstance = new DataShare();
        window.DataShare = dataShareInstance;

        console.log(
          "âœ… [HTML] DataShare ì¸ìŠ¤í„´ìŠ¤ ìƒì„± ì™„ë£Œ:",
          window.DataShare
        );
        console.log(
          "âœ… [HTML] DataShare ë©”ì„œë“œë“¤:",
          Object.getOwnPropertyNames(window.DataShare)
        );

        // ë©”ì„œë“œ ì¡´ì¬ ì—¬ë¶€ í™•ì¸
        const requiredMethods = [
          "set",
          "get",
          "watch",
          "clear",
          "getAll",
          "setDevMode",
        ];
        const missingMethods = requiredMethods.filter(
          (method) => typeof window.DataShare[method] !== "function"
        );

        if (missingMethods.length === 0) {
          console.log("âœ… [HTML] ëª¨ë“  í•„ìˆ˜ ë©”ì„œë“œê°€ ì •ìƒì ìœ¼ë¡œ ì¡´ì¬í•©ë‹ˆë‹¤.");
        } else {
          console.error("âŒ [HTML] ëˆ„ë½ëœ ë©”ì„œë“œë“¤:", missingMethods);
        }

        // ê°„ë‹¨í•œ í…ŒìŠ¤íŠ¸
        window.DataShare.set("test", "init");
        const testValue = window.DataShare.get("test");
        if (testValue === "init") {
          console.log("âœ… [HTML] DataShare ê¸°ë³¸ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸ í†µê³¼");
          window.DataShare.clear("test");
        } else {
          console.error("âŒ [HTML] DataShare ê¸°ë³¸ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨");
        }
      } catch (error) {
        console.error("âŒ [HTML] DataShare ì¸ìŠ¤í„´ìŠ¤ ìƒì„± ì‹¤íŒ¨:", error);
        window.DataShare = null;
      }

      let watchUnsubscribe = null;
      let logCounter = 0;

      // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
      document.addEventListener("DOMContentLoaded", function () {
        console.log("ğŸ¯ [HTML] DOM ë¡œë”© ì™„ë£Œ, DataShare ì´ˆê¸°í™” ì‹œì‘");

        // DataShare ê°ì²´ ìƒíƒœ í™•ì¸
        console.log("ğŸ” [HTML] DataShare ìƒíƒœ í™•ì¸:", {
          exists: typeof window.DataShare !== "undefined",
          hasGetAll:
            window.DataShare && typeof window.DataShare.getAll === "function",
          hasSet:
            window.DataShare && typeof window.DataShare.set === "function",
        });

        if (typeof window.DataShare !== "undefined" && window.DataShare) {
          updateCurrentData();
          addLog("ì‹œìŠ¤í…œ", "DataShare ìœ í‹¸ë¦¬í‹° ì´ˆê¸°í™” ì™„ë£Œ (ì¸ë¼ì¸ ë²„ì „)");

          // ê°œë°œ ëª¨ë“œ ê¸°ë³¸ í™œì„±í™”
          document.getElementById("devMode").checked = true;
          DataShare.setDevMode(true);
        } else {
          console.error("âŒ [HTML] DataShare ê°ì²´ê°€ ì—†ìŠµë‹ˆë‹¤!");
          addLog("ERROR", "DataShare ì´ˆê¸°í™” ì‹¤íŒ¨");
        }

        // ìë™ í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤ ì‹¤í–‰
        setTimeout(() => {
          if (typeof window.DataShare !== "undefined" && window.DataShare) {
            addLog("AUTO", "ìë™ í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤...");

            // 1. ê¸°ë³¸ ë°ì´í„° ì„¤ì •
            DataShare.set("app.name", "DataShare í…ŒìŠ¤íŠ¸ ì•± (ì¸ë¼ì¸)");
            DataShare.set("user.profile", { name: "í…ŒìŠ¤íŠ¸ ì‚¬ìš©ì", age: 25 });
            DataShare.set("settings.theme", "dark");

            updateCurrentData();
            addLog("AUTO", "ì´ˆê¸° í…ŒìŠ¤íŠ¸ ë°ì´í„°ê°€ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤.");

            // 2. ê°ì‹œ ì„¤ì •
            setTimeout(() => {
              document.getElementById("watchKey").value = "user.*";
              testWatch();
            }, 1000);
          } else {
            console.error(
              "âŒ [AUTO] DataShareê°€ ì¤€ë¹„ë˜ì§€ ì•Šì•„ ìë™ í…ŒìŠ¤íŠ¸ë¥¼ ê±´ë„ˆëœë‹ˆë‹¤."
            );
            addLog("ERROR", "ìë™ í…ŒìŠ¤íŠ¸ ê±´ë„ˆëœ€ - DataShare ì—†ìŒ");
          }
        }, 1000);
      });

      /**
       * ë¡œê·¸ ì¶”ê°€ í•¨ìˆ˜
       */
      function addLog(action, message, key = "", value = "") {
        const output = document.getElementById("output");
        const time = new Date().toLocaleTimeString();
        logCounter++;

        const logEntry = document.createElement("div");
        logEntry.className = "log-entry";
        logEntry.innerHTML = `
        <span class="log-time">[${time}]</span>
        <span class="log-action">${action}</span>
        ${key ? `<span class="log-key">${key}</span>` : ""}
        ${
          value ? `<span class="log-value">${JSON.stringify(value)}</span>` : ""
        }
        <span>${message}</span>
      `;

        output.insertBefore(logEntry, output.firstChild);

        // ë¡œê·¸ê°€ ë„ˆë¬´ ë§ì•„ì§€ë©´ ì˜¤ë˜ëœ ê²ƒ ì œê±°
        if (output.children.length > 50) {
          output.removeChild(output.lastChild);
        }
      }

      /**
       * í˜„ì¬ ë°ì´í„° í‘œì‹œ ì—…ë°ì´íŠ¸
       */
      function updateCurrentData() {
        const currentDataDiv = document.getElementById("currentData");

        // DataShare ê°ì²´ê°€ ì¡´ì¬í•˜ê³  getAll ë©”ì„œë“œê°€ ìˆëŠ”ì§€ í™•ì¸
        if (
          typeof window.DataShare === "undefined" ||
          !window.DataShare ||
          typeof window.DataShare.getAll !== "function"
        ) {
          console.warn(
            "[updateCurrentData] DataShareê°€ ì•„ì§ ì¤€ë¹„ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤."
          );
          currentDataDiv.innerHTML = "<em>DataShare ë¡œë”© ì¤‘...</em>";
          return;
        }

        const allData = DataShare.getAll();
        const keys = Object.keys(allData);

        if (keys.length === 0) {
          currentDataDiv.innerHTML = "<em>ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</em>";
          return;
        }

        let html = "";
        keys.forEach((key) => {
          const value = allData[key];
          html += `
          <div class="data-item">
            <span class="data-key">${key}:</span>
            <span class="data-value">${JSON.stringify(value, null, 2)}</span>
          </div>
        `;
        });

        currentDataDiv.innerHTML = html;
      }

      /**
       * SET í…ŒìŠ¤íŠ¸
       */
      function testSet() {
        const key = document.getElementById("setKey").value.trim();
        const valueStr = document.getElementById("setValue").value.trim();

        if (!key) {
          alert("í‚¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
          return;
        }

        try {
          let value;
          // JSON íŒŒì‹± ì‹œë„
          try {
            value = JSON.parse(valueStr);
          } catch (e) {
            // JSONì´ ì•„ë‹ˆë©´ ë¬¸ìì—´ë¡œ ì²˜ë¦¬
            value = valueStr;
          }

          DataShare.set(key, value);
          addLog("SET", "ë°ì´í„°ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.", key, value);
          updateCurrentData();
          updateStatus("ë°ì´í„° ì €ì¥ë¨", "success");
        } catch (error) {
          addLog("ERROR", error.message);
          updateStatus("ì €ì¥ ì‹¤íŒ¨", "error");
        }
      }

      /**
       * GET í…ŒìŠ¤íŠ¸
       */
      function testGet() {
        const key = document.getElementById("setKey").value.trim();

        if (!key) {
          alert("í‚¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
          return;
        }

        try {
          const value = DataShare.get(key);
          addLog("GET", "ë°ì´í„°ë¥¼ ì¡°íšŒí–ˆìŠµë‹ˆë‹¤.", key, value);

          if (value !== undefined) {
            document.getElementById("setValue").value =
              typeof value === "string"
                ? value
                : JSON.stringify(value, null, 2);
            updateStatus("ë°ì´í„° ì¡°íšŒë¨", "success");
          } else {
            updateStatus("ë°ì´í„° ì—†ìŒ", "warning");
          }
        } catch (error) {
          addLog("ERROR", error.message);
          updateStatus("ì¡°íšŒ ì‹¤íŒ¨", "error");
        }
      }

      /**
       * CLEAR í…ŒìŠ¤íŠ¸
       */
      function testClear() {
        const key = document.getElementById("setKey").value.trim();

        if (!key) {
          alert("í‚¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
          return;
        }

        try {
          DataShare.clear(key);
          addLog("CLEAR", "ë°ì´í„°ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.", key);
          updateCurrentData();
          updateStatus("ë°ì´í„° ì‚­ì œë¨", "success");
        } catch (error) {
          addLog("ERROR", error.message);
          updateStatus("ì‚­ì œ ì‹¤íŒ¨", "error");
        }
      }

      /**
       * CLEAR ALL í…ŒìŠ¤íŠ¸
       */
      function testClearAll() {
        if (confirm("ëª¨ë“  ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
          try {
            DataShare.clear();
            addLog("CLEAR ALL", "ëª¨ë“  ë°ì´í„°ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
            updateCurrentData();
            updateStatus("ì „ì²´ ì‚­ì œë¨", "success");
          } catch (error) {
            addLog("ERROR", error.message);
            updateStatus("ì‚­ì œ ì‹¤íŒ¨", "error");
          }
        }
      }

      /**
       * TEMP í…ŒìŠ¤íŠ¸
       */
      function testTemp() {
        const key = document.getElementById("setKey").value.trim();
        const valueStr = document.getElementById("setValue").value.trim();
        const ttl = parseInt(document.getElementById("tempTtl").value) || 5000;

        if (!key) {
          alert("í‚¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
          return;
        }

        try {
          let value;
          try {
            value = JSON.parse(valueStr);
          } catch (e) {
            value = valueStr;
          }

          DataShare.temp(key, value, ttl);
          addLog(
            "TEMP",
            `ì„ì‹œ ë°ì´í„°ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤. (TTL: ${ttl}ms)`,
            key,
            value
          );
          updateCurrentData();
          updateStatus(`ì„ì‹œ ì €ì¥ë¨ (${ttl / 1000}ì´ˆ)`, "success");
        } catch (error) {
          addLog("ERROR", error.message);
          updateStatus("ì„ì‹œ ì €ì¥ ì‹¤íŒ¨", "error");
        }
      }

      /**
       * WATCH í…ŒìŠ¤íŠ¸
       */
      function testWatch() {
        const watchKey = document.getElementById("watchKey").value.trim();

        if (!watchKey) {
          alert("ê°ì‹œí•  í‚¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
          return;
        }

        // ê¸°ì¡´ ê°ì‹œ í•´ì œ
        if (watchUnsubscribe) {
          watchUnsubscribe();
        }

        try {
          watchUnsubscribe = DataShare.watch(
            watchKey,
            function (newValue, oldValue, key) {
              addLog("WATCH", `ë°ì´í„° ë³€ê²½ ê°ì§€`, key, {
                old: oldValue,
                new: newValue,
              });
              updateCurrentData();
            }
          );

          addLog("WATCH", `ê°ì‹œ ì‹œì‘`, watchKey);
          updateStatus(`ê°ì‹œ ì¤‘: ${watchKey}`, "watching");
        } catch (error) {
          addLog("ERROR", error.message);
          updateStatus("ê°ì‹œ ì‹œì‘ ì‹¤íŒ¨", "error");
        }
      }

      /**
       * WATCH í•´ì œ í…ŒìŠ¤íŠ¸
       */
      function testUnwatch() {
        if (watchUnsubscribe) {
          watchUnsubscribe();
          watchUnsubscribe = null;
          addLog("UNWATCH", "ê°ì‹œê°€ ì¤‘ì§€ë˜ì—ˆìŠµë‹ˆë‹¤.");
          updateStatus("ê°ì‹œ ì¤‘ì§€ë¨", "success");
        } else {
          addLog("INFO", "í™œì„±í™”ëœ ê°ì‹œê°€ ì—†ìŠµë‹ˆë‹¤.");
          updateStatus("ê°ì‹œ ì—†ìŒ", "warning");
        }
      }

      /**
       * ê°œë°œ ëª¨ë“œ í† ê¸€
       */
      function toggleDevMode() {
        const devMode = document.getElementById("devMode").checked;
        DataShare.setDevMode(devMode);
        addLog("SYSTEM", `ê°œë°œ ëª¨ë“œ: ${devMode ? "í™œì„±í™”" : "ë¹„í™œì„±í™”"}`);
      }

      /**
       * ë¡œê·¸ ì§€ìš°ê¸°
       */
      function clearLogs() {
        const output = document.getElementById("output");
        output.innerHTML =
          '<div class="log-entry"><span class="log-time">[ì§€ì›Œì§]</span><span class="log-action">ë¡œê·¸ê°€ ì§€ì›Œì¡ŒìŠµë‹ˆë‹¤.</span></div>';
        logCounter = 0;
      }

      /**
       * ìƒíƒœ í‘œì‹œ ì—…ë°ì´íŠ¸
       */
      function updateStatus(message, type = "success") {
        const status = document.getElementById("status");
        status.textContent = message;

        // ìƒ‰ìƒ ë³€ê²½
        const colors = {
          success: "#4caf50",
          error: "#f44336",
          warning: "#ff9800",
          watching: "#2196F3",
        };

        status.style.backgroundColor = colors[type] || colors.success;

        // 3ì´ˆ í›„ ê¸°ë³¸ ìƒíƒœë¡œ ë³µì›
        setTimeout(() => {
          status.textContent = "DataShare ì¤€ë¹„ë¨";
          status.style.backgroundColor = colors.success;
        }, 3000);
      }
    </script>
  </body>
</html>
