<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CheckboxManager IIFE ë²„ì „ (ìˆœìˆ˜ ìë°”ìŠ¤í¬ë¦½íŠ¸)</title>
    <style>
      .container {
        max-width: 800px;
        margin: 20px auto;
        padding: 20px;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      }

      .demo-section {
        margin: 30px 0;
        border: 1px solid #e0e0e0;
        border-radius: 8px;
        overflow: hidden;
      }

      .demo-header {
        background: #f5f5f5;
        padding: 15px 20px;
        font-weight: bold;
        font-size: 16px;
        border-bottom: 1px solid #e0e0e0;
      }

      .demo-content {
        padding: 20px;
      }

      .checkbox-group {
        margin: 15px 0;
      }

      .all-check {
        background: #e3f2fd;
        padding: 12px 15px;
        border-radius: 5px;
        margin-bottom: 10px;
        font-weight: 600;
      }

      .item-list {
        background: #fafafa;
        border-radius: 5px;
        overflow: hidden;
      }

      .item {
        padding: 10px 15px;
        border-bottom: 1px solid #eee;
        transition: background-color 0.2s;
      }

      .item:last-child {
        border-bottom: none;
      }

      .item:hover {
        background-color: #f0f0f0;
      }

      .item input[type="checkbox"] {
        margin-right: 10px;
        transform: scale(1.1);
      }

      .all-check input[type="checkbox"] {
        margin-right: 10px;
        transform: scale(1.2);
      }

      .status-info {
        margin-top: 15px;
        padding: 12px;
        background: #fff8e1;
        border-radius: 5px;
        border-left: 4px solid #ffc107;
        font-size: 14px;
      }

      .code-example {
        background: #f8f9fa;
        border: 1px solid #e9ecef;
        border-radius: 5px;
        padding: 15px;
        margin: 15px 0;
        font-family: "Courier New", monospace;
        font-size: 13px;
        color: #495057;
        overflow-x: auto;
      }

      .btn-group {
        margin: 15px 0;
      }

      .btn {
        display: inline-block;
        padding: 8px 16px;
        margin: 0 5px 5px 0;
        background: #007bff;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 14px;
        transition: background-color 0.2s;
      }

      .btn:hover {
        background: #0056b3;
      }

      .btn-secondary {
        background: #6c757d;
      }

      .btn-secondary:hover {
        background: #545b62;
      }

      .state-indicator {
        display: inline-block;
        padding: 2px 8px;
        border-radius: 12px;
        font-size: 12px;
        font-weight: bold;
        margin-left: 10px;
      }

      .state-none {
        background: #e9ecef;
        color: #6c757d;
      }

      .state-partial {
        background: #fff3cd;
        color: #856404;
      }

      .state-all {
        background: #d4edda;
        color: #155724;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>ğŸ“¦ CheckboxManager IIFE ë²„ì „ (ìˆœìˆ˜ ìë°”ìŠ¤í¬ë¦½íŠ¸)</h1>

      <div class="code-example">
        <strong>IIFE ì‚¬ìš©ë²•:</strong><br />
        // ê¸°ë³¸ ì‚¬ìš©<br />
        const manager = CheckboxManager('#allCheck', '.itemCheck');<br /><br />
        // ì˜µì…˜ê³¼ í•¨ê»˜ ì‚¬ìš©<br />
        const manager = CheckboxManager('#allCheck', '.itemCheck', {<br />
        &nbsp;&nbsp;showIndeterminate: false,<br />
        &nbsp;&nbsp;onChange: (data) => console.log(data),<br />
        &nbsp;&nbsp;debug: true<br />
        });
      </div>

      <!-- ê¸°ë³¸ ì˜ˆì œ -->
      <div class="demo-section">
        <div class="demo-header">ğŸ›ï¸ ìƒí’ˆ ì„ íƒ (showIndeterminate: false)</div>
        <div class="demo-content">
          <div class="checkbox-group">
            <div class="all-check">
              <label>
                <input type="checkbox" id="products-all" />
                <span>ì „ì²´ ìƒí’ˆ ì„ íƒ</span>
                <span class="state-indicator state-none" id="products-state"
                  >ì—†ìŒ</span
                >
              </label>
            </div>

            <div class="item-list">
              <div class="item">
                <label>
                  <input
                    type="checkbox"
                    class="product-item"
                    value="laptop"
                    data-name="ë…¸íŠ¸ë¶"
                    data-price="1200000"
                  />
                  ë…¸íŠ¸ë¶ ì»´í“¨í„° (â‚©1,200,000)
                </label>
              </div>
              <div class="item">
                <label>
                  <input
                    type="checkbox"
                    class="product-item"
                    value="mouse"
                    data-name="ë§ˆìš°ìŠ¤"
                    data-price="35000"
                  />
                  ë¬´ì„  ë§ˆìš°ìŠ¤ (â‚©35,000)
                </label>
              </div>
              <div class="item">
                <label>
                  <input
                    type="checkbox"
                    class="product-item"
                    value="keyboard"
                    data-name="í‚¤ë³´ë“œ"
                    data-price="150000"
                  />
                  ê¸°ê³„ì‹ í‚¤ë³´ë“œ (â‚©150,000)
                </label>
              </div>
              <div class="item">
                <label>
                  <input
                    type="checkbox"
                    class="product-item"
                    value="monitor"
                    data-name="ëª¨ë‹ˆí„°"
                    data-price="400000"
                  />
                  4K ëª¨ë‹ˆí„° (â‚©400,000)
                </label>
              </div>
            </div>
          </div>

          <div class="btn-group">
            <button class="btn" onclick="productManager.checkAll()">
              ì „ì²´ ì„ íƒ
            </button>
            <button class="btn" onclick="productManager.uncheckAll()">
              ì „ì²´ í•´ì œ
            </button>
            <button
              class="btn"
              onclick="productManager.checkValues(['laptop', 'mouse'])"
            >
              ë…¸íŠ¸ë¶+ë§ˆìš°ìŠ¤
            </button>
            <button
              class="btn btn-secondary"
              onclick="showManagerStatus('productManager')"
            >
              ìƒíƒœ í™•ì¸
            </button>
          </div>

          <div class="status-info" id="products-status">ìƒíƒœ: ì¤€ë¹„ë¨</div>
        </div>
      </div>

      <!-- ì¤‘ê°„ìƒíƒœ í‘œì‹œ ì˜ˆì œ -->
      <div class="demo-section">
        <div class="demo-header">
          ğŸ‘¥ ì‚¬ìš©ì ê¶Œí•œ ê´€ë¦¬ (showIndeterminate: true)
        </div>
        <div class="demo-content">
          <div class="checkbox-group">
            <div class="all-check">
              <label>
                <input type="checkbox" id="users-all" />
                <span>ëª¨ë“  ì‚¬ìš©ì ì„ íƒ</span>
                <span class="state-indicator state-none" id="users-state"
                  >ì—†ìŒ</span
                >
              </label>
            </div>

            <div class="item-list">
              <div class="item">
                <label>
                  <input
                    type="checkbox"
                    class="user-item"
                    value="admin"
                    data-role="ê´€ë¦¬ì"
                  />
                  ê´€ë¦¬ì (admin@company.com)
                </label>
              </div>
              <div class="item">
                <label>
                  <input
                    type="checkbox"
                    class="user-item"
                    value="editor"
                    data-role="í¸ì§‘ì"
                  />
                  í¸ì§‘ì (editor@company.com)
                </label>
              </div>
              <div class="item">
                <label>
                  <input
                    type="checkbox"
                    class="user-item"
                    value="viewer"
                    data-role="ì¡°íšŒì"
                  />
                  ì¡°íšŒì (viewer@company.com)
                </label>
              </div>
              <div class="item">
                <label>
                  <input
                    type="checkbox"
                    class="user-item"
                    value="guest"
                    data-role="ê²ŒìŠ¤íŠ¸"
                  />
                  ê²ŒìŠ¤íŠ¸ (guest@company.com)
                </label>
              </div>
            </div>
          </div>

          <div class="btn-group">
            <button class="btn" onclick="userManager.toggle()">
              ì „ì²´ í† ê¸€
            </button>
            <button
              class="btn"
              onclick="userManager.checkValues(['admin', 'editor'])"
            >
              ê´€ë¦¬ì+í¸ì§‘ì
            </button>
            <button class="btn" onclick="userManager.inverse()">
              ì„ íƒ ë°˜ì „
            </button>
            <button
              class="btn btn-secondary"
              onclick="showManagerStatus('userManager')"
            >
              ìƒíƒœ í™•ì¸
            </button>
          </div>

          <div class="status-info" id="users-status">ìƒíƒœ: ì¤€ë¹„ë¨</div>
        </div>
      </div>

      <!-- ë™ì  ì¶”ê°€ ì˜ˆì œ -->
      <div class="demo-section">
        <div class="demo-header">â• ë™ì  ì•„ì´í…œ ì¶”ê°€/ì‚­ì œ</div>
        <div class="demo-content">
          <div class="checkbox-group">
            <div class="all-check">
              <label>
                <input type="checkbox" id="dynamic-all" />
                <span>ì „ì²´ í• ì¼ ì„ íƒ</span>
                <span class="state-indicator state-none" id="dynamic-state"
                  >ì—†ìŒ</span
                >
              </label>
            </div>

            <div class="item-list" id="dynamic-list">
              <div class="item">
                <label>
                  <input
                    type="checkbox"
                    class="todo-item"
                    value="1"
                    data-task="íšŒì˜ ì°¸ì„"
                  />
                  íšŒì˜ ì°¸ì„ (ì˜¤í›„ 2ì‹œ)
                </label>
              </div>
              <div class="item">
                <label>
                  <input
                    type="checkbox"
                    class="todo-item"
                    value="2"
                    data-task="ë³´ê³ ì„œ ì‘ì„±"
                  />
                  ë³´ê³ ì„œ ì‘ì„± (ë§ˆê°: ë‚´ì¼)
                </label>
              </div>
            </div>
          </div>

          <div class="btn-group">
            <button class="btn" onclick="addTodoItem()">í• ì¼ ì¶”ê°€</button>
            <button class="btn" onclick="removeSelectedItems()">
              ì„ íƒ í•­ëª© ì‚­ì œ
            </button>
            <button class="btn btn-secondary" onclick="todoManager.refresh()">
              ìƒíƒœ ìƒˆë¡œê³ ì¹¨
            </button>
          </div>

          <div class="status-info" id="todos-status">ìƒíƒœ: ì¤€ë¹„ë¨</div>
        </div>
      </div>
    </div>

    <script>
      /**
       * CheckboxManager IIFE ë²„ì „ - ìˆœìˆ˜ ìë°”ìŠ¤í¬ë¦½íŠ¸ ì²´í¬ë°•ìŠ¤ ì „ì²´ì„ íƒ ëª¨ë“ˆ
       * @version 3.0.0 (IIFE + Vanilla JS)
       * @author ì›¹ê°œë°œì
       */
      const CheckboxManager = (() => {
        "use strict";

        // í”„ë¼ì´ë¹— ë³€ìˆ˜ë“¤
        const instances = new Map();
        let instanceCounter = 0;

        // ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤
        const utils = {
          // ìš”ì†Œ ì„ íƒ (CSS ì„ íƒì ì§€ì›)
          select: (selector, context = document) => {
            if (typeof selector === "string") {
              return context.querySelector(selector);
            }
            return selector;
          },

          // ë‹¤ì¤‘ ìš”ì†Œ ì„ íƒ
          selectAll: (selector, context = document) => {
            if (typeof selector === "string") {
              return Array.from(context.querySelectorAll(selector));
            }
            return Array.isArray(selector) ? selector : [selector];
          },

          // ë°ì´í„° ì†ì„± ê°€ì ¸ì˜¤ê¸°
          getData: (element) => {
            const data = {};
            for (let attr of element.attributes) {
              if (attr.name.startsWith("data-")) {
                const key = attr.name
                  .slice(5)
                  .replace(/-([a-z])/g, (g) => g[1].toUpperCase());
                data[key] = attr.value;
              }
            }
            return data;
          },

          // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€ (ìœ„ì„ ì§€ì›)
          on: (element, event, selector, handler) => {
            if (typeof selector === "function") {
              handler = selector;
              element.addEventListener(event, handler);
              return { element, event, handler };
            } else {
              const delegateHandler = (e) => {
                if (e.target.matches(selector)) {
                  handler.call(e.target, e);
                }
              };
              element.addEventListener(event, delegateHandler);
              return { element, event, handler: delegateHandler };
            }
          },

          // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì œê±°
          off: (eventData) => {
            eventData.element.removeEventListener(
              eventData.event,
              eventData.handler
            );
          },

          // ì˜µì…˜ ë³‘í•©
          extend: (target, ...sources) => {
            return Object.assign({}, target, ...sources);
          },
        };

        // ì²´í¬ë°•ìŠ¤ ë§¤ë‹ˆì € ìƒì„±ì í•¨ìˆ˜
        function createManager(allSelector, itemSelector, options = {}) {
          const instanceId = ++instanceCounter;

          // ê¸°ë³¸ ì˜µì…˜
          const defaultOptions = {
            showIndeterminate: false,
            autoInit: true,
            onChange: null,
            onAllChange: null,
            onItemChange: null,
            container: document,
            debug: false,
          };

          const config = utils.extend(defaultOptions, options);

          // í”„ë¼ì´ë¹— ìƒíƒœ
          let isInitialized = false;
          let eventListeners = [];

          // DOM ìš”ì†Œ ì°¸ì¡°
          const getElements = () => ({
            allCheckbox: utils.select(allSelector, config.container),
            itemCheckboxes: utils.selectAll(itemSelector, config.container),
          });

          // ë¡œê·¸ í•¨ìˆ˜
          const log = (...args) => {
            if (config.debug) {
              console.log(`[CheckboxManager-${instanceId}]`, ...args);
            }
          };

          // ì½œë°± ì‹¤í–‰
          const executeCallback = (callbackName, data) => {
            const callback = config[callbackName];
            if (typeof callback === "function") {
              try {
                callback.call(instance, data);
              } catch (error) {
                console.error(
                  `CheckboxManager ì½œë°± ì˜¤ë¥˜ (${callbackName}):`,
                  error
                );
              }
            }
          };

          // ìƒíƒœ í‘œì‹œê¸° ì—…ë°ì´íŠ¸
          const updateStateIndicator = (state) => {
            const allId = allSelector.replace("#", "");
            const stateIndicator = utils.select(`#${allId}-state`);

            if (!stateIndicator) return;

            const stateConfig = {
              none: { className: "state-none", text: "ì—†ìŒ" },
              partial: { className: "state-partial", text: "ì¼ë¶€" },
              all: { className: "state-all", text: "ì „ì²´" },
            };

            const stateData = stateConfig[state] || stateConfig.none;

            // ê¸°ì¡´ í´ë˜ìŠ¤ ì œê±°
            stateIndicator.className =
              stateIndicator.className.replace(/state-\w+/g, "").trim() +
              " " +
              stateData.className;

            stateIndicator.textContent = stateData.text;
          };

          // ì „ì²´ ì²´í¬ë°•ìŠ¤ ìƒíƒœ ì—…ë°ì´íŠ¸
          const updateAllCheckboxState = () => {
            const { allCheckbox, itemCheckboxes } = getElements();

            if (!allCheckbox || itemCheckboxes.length === 0) {
              if (allCheckbox) {
                allCheckbox.checked = false;
                allCheckbox.indeterminate = false;
              }
              return;
            }

            const totalItems = itemCheckboxes.length;
            const checkedItems = itemCheckboxes.filter(
              (item) => item.checked
            ).length;

            if (checkedItems === 0) {
              // ì•„ë¬´ê²ƒë„ ì„ íƒë˜ì§€ ì•ŠìŒ
              allCheckbox.checked = false;
              allCheckbox.indeterminate = false;
              updateStateIndicator("none");
            } else if (checkedItems === totalItems) {
              // ëª¨ë“  í•­ëª© ì„ íƒë¨
              allCheckbox.checked = true;
              allCheckbox.indeterminate = false;
              updateStateIndicator("all");
            } else {
              // ì¼ë¶€ë§Œ ì„ íƒë¨
              allCheckbox.checked = false;
              allCheckbox.indeterminate = config.showIndeterminate;
              updateStateIndicator("partial");
            }
          };

          // ì „ì²´ ì²´í¬ë°•ìŠ¤ ë³€ê²½ í•¸ë“¤ëŸ¬
          const handleAllChange = (e) => {
            const { itemCheckboxes } = getElements();
            const isChecked = e.target.checked;

            // ëª¨ë“  ê°œë³„ ì²´í¬ë°•ìŠ¤ ìƒíƒœ ë³€ê²½
            itemCheckboxes.forEach((item) => {
              item.checked = isChecked;
            });

            const changeData = getChangeData();

            executeCallback("onAllChange", {
              checked: isChecked,
              selectedValues: changeData.selectedValues,
              selectedItems: changeData.selectedItems,
            });

            executeCallback("onChange", changeData);

            log(`ì „ì²´ ì„ íƒ: ${isChecked}`, changeData.selectedValues);
          };

          // ê°œë³„ ì²´í¬ë°•ìŠ¤ ë³€ê²½ í•¸ë“¤ëŸ¬
          const handleItemChange = (e) => {
            updateAllCheckboxState();

            const changeData = getChangeData();

            executeCallback("onItemChange", {
              target: e.target,
              checked: e.target.checked,
              value: e.target.value,
              selectedValues: changeData.selectedValues,
              selectedItems: changeData.selectedItems,
            });

            executeCallback("onChange", changeData);

            log("ê°œë³„ ì„ íƒ ë³€ê²½", changeData.selectedValues);
          };

          // ë³€ê²½ ë°ì´í„° ìƒì„±
          const getChangeData = () => {
            const { itemCheckboxes } = getElements();
            const checkedItems = itemCheckboxes.filter((item) => item.checked);

            const selectedValues = checkedItems.map((item) => item.value);
            const selectedItems = checkedItems.map((item) => ({
              element: item,
              value: item.value,
              text: item.parentElement.textContent.trim(),
              data: utils.getData(item),
            }));

            const selectedCount = checkedItems.length;
            const totalCount = itemCheckboxes.length;

            let selectionState = "none";
            if (selectedCount === totalCount && totalCount > 0) {
              selectionState = "all";
            } else if (selectedCount > 0) {
              selectionState = "partial";
            }

            return {
              selectedValues,
              selectedItems,
              selectedCount,
              totalCount,
              isAllSelected: selectedCount === totalCount && totalCount > 0,
              isNoneSelected: selectedCount === 0,
              isPartialSelected:
                selectedCount > 0 && selectedCount < totalCount,
              selectionState,
            };
          };

          // ê³µê°œ API
          const instance = {
            // ì´ˆê¸°í™”
            init() {
              if (isInitialized) {
                log("ì´ë¯¸ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.");
                return this;
              }

              const container = utils.select(config.container);

              // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡ (ìœ„ì„ ë°©ì‹)
              const allChangeListener = utils.on(
                container,
                "change",
                allSelector,
                handleAllChange
              );
              const itemChangeListener = utils.on(
                container,
                "change",
                itemSelector,
                handleItemChange
              );

              eventListeners.push(allChangeListener, itemChangeListener);

              // ì´ˆê¸° ìƒíƒœ ì„¤ì •
              updateAllCheckboxState();

              isInitialized = true;
              log("CheckboxManager ì´ˆê¸°í™” ì™„ë£Œ");

              return this;
            },

            // ì „ì²´ ì„ íƒ
            checkAll() {
              const { itemCheckboxes } = getElements();
              itemCheckboxes.forEach((item) => {
                item.checked = true;
              });
              updateAllCheckboxState();
              executeCallback("onChange", getChangeData());
              return this;
            },

            // ì „ì²´ í•´ì œ
            uncheckAll() {
              const { itemCheckboxes } = getElements();
              itemCheckboxes.forEach((item) => {
                item.checked = false;
              });
              updateAllCheckboxState();
              executeCallback("onChange", getChangeData());
              return this;
            },

            // ì „ì²´ í† ê¸€
            toggle() {
              const { allCheckbox } = getElements();
              return allCheckbox && allCheckbox.checked
                ? this.uncheckAll()
                : this.checkAll();
            },

            // ì„ íƒ ë°˜ì „
            inverse() {
              const { itemCheckboxes } = getElements();
              itemCheckboxes.forEach((item) => {
                item.checked = !item.checked;
              });
              updateAllCheckboxState();
              executeCallback("onChange", getChangeData());
              return this;
            },

            // íŠ¹ì • ê°’ë“¤ ì„ íƒ
            checkValues(values) {
              const valueArray = Array.isArray(values) ? values : [values];
              const { itemCheckboxes } = getElements();

              itemCheckboxes.forEach((item) => {
                item.checked = valueArray.includes(item.value);
              });

              updateAllCheckboxState();
              executeCallback("onChange", getChangeData());
              return this;
            },

            // íŠ¹ì • ê°’ë“¤ í•´ì œ
            uncheckValues(values) {
              const valueArray = Array.isArray(values) ? values : [values];
              const { itemCheckboxes } = getElements();

              itemCheckboxes.forEach((item) => {
                if (valueArray.includes(item.value)) {
                  item.checked = false;
                }
              });

              updateAllCheckboxState();
              executeCallback("onChange", getChangeData());
              return this;
            },

            // ì„ íƒëœ ê°’ë“¤ ê°€ì ¸ì˜¤ê¸°
            getSelectedValues() {
              return getChangeData().selectedValues;
            },

            // ì„ íƒëœ ì•„ì´í…œ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
            getSelectedItems() {
              return getChangeData().selectedItems;
            },

            // ì„ íƒ ê°œìˆ˜ ê°€ì ¸ì˜¤ê¸°
            getSelectedCount() {
              return getChangeData().selectedCount;
            },

            // ì „ì²´ ê°œìˆ˜ ê°€ì ¸ì˜¤ê¸°
            getTotalCount() {
              return getChangeData().totalCount;
            },

            // ì„ íƒ ìƒíƒœ í™•ì¸
            getSelectionState() {
              return getChangeData().selectionState;
            },

            // ë³€ê²½ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
            getChangeData() {
              return getChangeData();
            },

            // ìƒíƒœ ìƒˆë¡œê³ ì¹¨
            refresh() {
              updateAllCheckboxState();
              executeCallback("onChange", getChangeData());
              return this;
            },

            // ì¸ìŠ¤í„´ìŠ¤ ì œê±°
            destroy() {
              eventListeners.forEach((listener) => {
                utils.off(listener);
              });
              eventListeners = [];
              instances.delete(instanceId);
              isInitialized = false;
              log("CheckboxManager ì œê±°ë¨");
              return this;
            },

            // ì¸ìŠ¤í„´ìŠ¤ ID ê°€ì ¸ì˜¤ê¸°
            getId() {
              return instanceId;
            },
          };

          // ì¸ìŠ¤í„´ìŠ¤ ì €ì¥
          instances.set(instanceId, instance);

          // ìë™ ì´ˆê¸°í™”
          if (config.autoInit) {
            instance.init();
          }

          return instance;
        }

        // íŒ©í† ë¦¬ í•¨ìˆ˜ ë°˜í™˜ (IIFEì˜ ë°˜í™˜ê°’)
        return createManager;
      })();

      // ì „ì—­ìœ¼ë¡œ ë…¸ì¶œ
      window.CheckboxManager = CheckboxManager;

      // ==========================================
      // ì‚¬ìš© ì˜ˆì œ ì½”ë“œ
      // ==========================================

      document.addEventListener("DOMContentLoaded", () => {
        // ìƒí’ˆ ê´€ë¦¬ì ìƒì„± (showIndeterminate: false)
        window.productManager = CheckboxManager(
          "#products-all",
          ".product-item",
          {
            showIndeterminate: false,
            debug: true,
            onChange: ({
              selectedCount,
              totalCount,
              selectedItems,
              selectionState,
            }) => {
              const status = `ì„ íƒëœ ìƒí’ˆ: ${selectedCount}/${totalCount}ê°œ (${selectionState})`;
              const items = selectedItems
                .map((item) => item.data.name || item.value)
                .join(", ");
              const totalPrice = selectedItems.reduce(
                (sum, item) => sum + (parseInt(item.data.price) || 0),
                0
              );

              document.getElementById("products-status").innerHTML = `
                        ${status}<br>
                        í•­ëª©: ${items || "ì—†ìŒ"}<br>
                        ì´ì•¡: ${totalPrice.toLocaleString()}ì›
                    `;
            },
          }
        );

        // ì‚¬ìš©ì ê´€ë¦¬ì ìƒì„± (showIndeterminate: true)
        window.userManager = CheckboxManager("#users-all", ".user-item", {
          showIndeterminate: true,
          onChange: ({
            selectedCount,
            totalCount,
            selectedItems,
            selectionState,
          }) => {
            const status = `ì„ íƒëœ ì‚¬ìš©ì: ${selectedCount}/${totalCount}ëª… (${selectionState})`;
            const users = selectedItems
              .map((item) => item.data.role || item.value)
              .join(", ");
            document.getElementById(
              "users-status"
            ).innerHTML = `${status}<br>ì—­í• : ${users || "ì—†ìŒ"}`;
          },
        });

        // í• ì¼ ê´€ë¦¬ì ìƒì„±
        window.todoManager = CheckboxManager("#dynamic-all", ".todo-item", {
          showIndeterminate: false,
          onChange: ({
            selectedCount,
            totalCount,
            selectedItems,
            selectionState,
          }) => {
            const status = `ì™„ë£Œëœ í• ì¼: ${selectedCount}/${totalCount}ê°œ (${selectionState})`;
            const tasks = selectedItems
              .map((item) => item.data.task || item.value)
              .join(", ");
            document.getElementById(
              "todos-status"
            ).innerHTML = `${status}<br>ì‘ì—…: ${tasks || "ì—†ìŒ"}`;
          },
        });
      });

      // ì „ì—­ ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤
      const showManagerStatus = (managerName) => {
        const manager = window[managerName];
        const data = manager.getChangeData();

        if (data.selectedCount === 0) {
          alert("ì„ íƒëœ í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤.");
          return;
        }

        const message = data.selectedItems
          .map(
            (item, index) => `${index + 1}. ${item.text} (ê°’: ${item.value})`
          )
          .join("\n");

        alert(
          `ì„ íƒ ìƒíƒœ: ${data.selectionState}\nì„ íƒëœ í•­ëª© (${data.selectedCount}ê°œ):\n\n${message}`
        );
      };

      // ë™ì  í• ì¼ ì¶”ê°€
      let todoCounter = 3;
      const addTodoItem = () => {
        const tasks = [
          "ì´ë©”ì¼ í™•ì¸",
          "ì½”ë“œ ë¦¬ë·°",
          "ë¬¸ì„œ ì—…ë°ì´íŠ¸",
          "ë¯¸íŒ… ì¤€ë¹„",
          "í…ŒìŠ¤íŠ¸ ì‹¤í–‰",
        ];
        const randomTask = tasks[Math.floor(Math.random() * tasks.length)];
        const currentTime = new Date().toLocaleTimeString();

        const newItem = document.createElement("div");
        newItem.className = "item";
        newItem.innerHTML = `
                <label>
                    <input type="checkbox" class="todo-item" value="${todoCounter}" data-task="${randomTask}">
                    ${randomTask} (ì¶”ê°€ë¨: ${currentTime})
                </label>
            `;

        document.getElementById("dynamic-list").appendChild(newItem);
        todoManager.refresh();
        todoCounter++;
      };

      // ì„ íƒëœ í• ì¼ ì‚­ì œ
      const removeSelectedItems = () => {
        const { selectedValues, selectedCount } = todoManager.getChangeData();

        if (selectedCount === 0) {
          alert("ì‚­ì œí•  í•­ëª©ì„ ì„ íƒí•´ì£¼ì„¸ìš”.");
          return;
        }

        if (confirm(`ì„ íƒëœ ${selectedCount}ê°œ í•­ëª©ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
          selectedValues.forEach((value) => {
            const item = document.querySelector(`.todo-item[value="${value}"]`);
            if (item) {
              item.closest(".item").remove();
            }
          });
          todoManager.refresh();
        }
      };

      // ê°œë°œì ì½˜ì†”ìš© í…ŒìŠ¤íŠ¸ í•¨ìˆ˜ë“¤
      const testFunctions = {
        checkLaptopMouse: () => productManager.checkValues(["laptop", "mouse"]),
        inverseUsers: () => userManager.inverse(),
        getSelectedTodos: () => todoManager.getSelectedItems(),
        showAllStates: () => {
          console.log("Product State:", productManager.getSelectionState());
          console.log("User State:", userManager.getSelectionState());
          console.log("Todo State:", todoManager.getSelectionState());
        },
        destroyProduct: () => productManager.destroy(),
        recreateProduct: () => {
          window.productManager = CheckboxManager(
            "#products-all",
            ".product-item",
            {
              showIndeterminate: false,
              debug: true,
              onChange: ({
                selectedCount,
                totalCount,
                selectedItems,
                selectionState,
              }) => {
                const status = `ì„ íƒëœ ìƒí’ˆ: ${selectedCount}/${totalCount}ê°œ (${selectionState})`;
                const items = selectedItems
                  .map((item) => item.data.name || item.value)
                  .join(", ");
                const totalPrice = selectedItems.reduce(
                  (sum, item) => sum + (parseInt(item.data.price) || 0),
                  0
                );

                document.getElementById("products-status").innerHTML = `
                            ${status}<br>
                            í•­ëª©: ${items || "ì—†ìŒ"}<br>
                            ì´ì•¡: ${totalPrice.toLocaleString()}ì›
                        `;
              },
            }
          );
        },
      };

      // í…ŒìŠ¤íŠ¸ í•¨ìˆ˜ë“¤ì„ ì „ì—­ì— ë…¸ì¶œ
      Object.assign(window, testFunctions);

      console.log("=== CheckboxManager IIFE í…ŒìŠ¤íŠ¸ í•¨ìˆ˜ ===");
      console.log("checkLaptopMouse() - ë…¸íŠ¸ë¶ê³¼ ë§ˆìš°ìŠ¤ ì„ íƒ");
      console.log("inverseUsers() - ì‚¬ìš©ì ì„ íƒ ë°˜ì „");
      console.log("getSelectedTodos() - ì„ íƒëœ í• ì¼ ì •ë³´");
      console.log("showAllStates() - ëª¨ë“  ë§¤ë‹ˆì € ìƒíƒœ í‘œì‹œ");
      console.log("destroyProduct() - ìƒí’ˆ ë§¤ë‹ˆì € ì œê±°");
      console.log("recreateProduct() - ìƒí’ˆ ë§¤ë‹ˆì € ì¬ìƒì„±");
      console.log("productManager.getChangeData() - ìƒí’ˆ ì„ íƒ ë°ì´í„°");
    </script>
  </body>
</html>
